<!DOCTYPE html><html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Mendeleev & Acids Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --f-main: 'Arial', sans-serif;
            --s-sym: 28px; --s-nam: 12px; --s-mas: 11px; --s-ox: 14px;
            --cols: 9; /* Установил 9 по умолчанию */
        }
        body { font-family: var(--f-main); background: #fff; padding: 20px; color: #000; }
        .panel {
            background: #f8f9fa; padding: 15px; border-radius: 10px;
            display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 20px;
            border: 1px solid #ddd; align-items: center; position: sticky; top: 0; z-index: 100;
        }
        .c-item { display: flex; flex-direction: column; gap: 4px; font-size: 11px; text-transform: uppercase; }
        #table-area {
            display: grid;
            grid-template-columns: 50px repeat(var(--cols), 125px);
            background: white; padding: 10px; width: fit-content;
        }
        .h-col, .h-row { font-weight: bold; color: #bbb; display: flex; align-items: center; justify-content: center; }
        .h-col { height: 40px; font-size: 20px; border-bottom: 2px solid #eee; }
        .h-row { width: 50px; font-size: 16px; border-right: 2px solid #eee; }
        .cell { 
            display: flex; flex-direction: column; padding: 10px; border: 0.5px solid #f0f0f0; 
            cursor: pointer; min-height: 100px; box-sizing: border-box; background: #fff;
            justify-content: center;
        }
        .cell:hover { background: #f0f7ff; border-color: #007bff; }
        .sym-row { display: flex; justify-content: space-between; align-items: flex-start; width: 100%; }
        .sym { font-size: var(--s-sym); font-weight: 800; line-height: 1.1; color: #1a1a1a; }
        /* Стиль для подстрочных/надстрочных индексов в символе */
        .sym sub { font-size: 0.5em; vertical-align: sub; }
        .sym sup { font-size: 0.5em; vertical-align: super; }
        
        .ox { font-size: var(--s-ox); color: #e63946; font-weight: bold; background: #fff1f2; padding: 2px 4px; border-radius: 4px; }
        .nam { font-size: var(--s-nam); color: #444; margin-top: 5px; text-transform: lowercase; font-weight: bold; }
        .mas { font-size: var(--s-mas); color: #999; margin-top: 2px; }
        
        button.dl { background: #1a1a1a; color: #fff; border: none; padding: 8px 15px; cursor: pointer; border-radius: 5px; font-weight: bold; font-size: 12px; }
        .save-cfg { background: #2a9d8f !important; margin-left: auto; }

        #modal-ov { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index: 1000; }
        #modal { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 12px; width: 280px; }
        #modal input { width: 100%; margin: 8px 0 15px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        .modal-btns { display: flex; gap: 10px; }
        .modal-btns button { flex: 1; padding: 10px; cursor: pointer; border-radius: 5px; border: none; font-weight: bold; }
    </style>
</head>
<body>

<div class="panel">
    <div class="c-item">Шрифт: <input type="file" id="fontUp"></div>
    <div class="c-item">Размер символа: <input type="range" min="15" max="60" value="28" oninput="upd('sym', this.value)"></div>
    <button class="dl" onclick="addRow()">+ Строка</button>
    <button class="dl" onclick="addCol()">+ Столбец</button>
    <div class="c-item">Конфиг: <input type="file" id="loadCfg" accept=".json"></div>
    <button class="dl save-cfg" onclick="saveConfig()">Сохранить конфиг</button>
    <button class="dl" onclick="saveJpg()">JPG</button>
</div>

<div id="table-area"></div>

<div id="modal-ov">
    <div id="modal">
        <h4 style="margin:0 0 10px">Редактировать ячейку</h4>
        <input type="text" id="ed-sym" placeholder="Символ (можно с <sup> и <sub>)">
        <input type="text" id="ed-nam" placeholder="Название">
        <input type="text" id="ed-mas" placeholder="Кислота / Масса">
        <input type="text" id="ed-ox" placeholder="Заряд">
        <div class="modal-btns">
            <button onclick="applyEdit()" style="background:#1a1a1a; color:white">ОК</button>
            <button onclick="closeModal()" style="background:#eee">Отмена</button>
        </div>
    </div>
</div>

<script>
    const upd = (t, v) => document.documentElement.style.setProperty(`--s-${t}`, v + 'px');
    let maxCols = 9, maxRows = 12;
    
    // Элементы + ДАННЫЕ С ФОТО В 9 СТОЛБИКЕ
    let elements = [
        ["H", "водород", "1.008", 1, 1, false, "+1/-1"], ["He", "гелий", "4.002", 8, 1, false, "0"],
        ["Li", "литий", "6.94", 1, 2, false, "+1"], ["Be", "бериллий", "9.01", 2, 2, false, "+2"], ["B", "бор", "10.81", 3, 2, false, "+3"], ["C", "углерод", "12.01", 4, 2, false, "-4"], ["N", "азот", "14.00", 5, 2, false, "-3"], ["O", "кислород", "15.99", 6, 2, false, "-2"], ["F", "фтор", "18.99", 7, 2, false, "-1"], ["Ne", "неон", "20.18", 8, 2, false, "0"],
        ["Na", "натрий", "22.99", 1, 3, false, "+1"], ["Mg", "магний", "24.30", 2, 3, false, "+2"], ["Al", "алюминий", "26.98", 3, 3, false, "+3"], ["Si", "кремний", "28.08", 4, 3, false, "-4"], ["P", "фосфор", "30.97", 5, 3, false, "-3"], ["S", "сера", "32.06", 6, 3, false, "-2"], ["Cl", "хлор", "35.45", 7, 3, false, "-1"], ["Ar", "аргон", "39.94", 8, 3, false, "0"],
        
        // --- 9 столбик (Кислотные остатки с фото) ---
        ["NO<sub>2</sub><sup>-</sup>", "Нитриты", "Азотистая", 9, 1, false, ""],
        ["NO<sub>3</sub><sup>-</sup>", "Нитраты", "Азотная", 9, 2, false, ""],
        ["Cl<sup>-</sup>", "Хлориды", "Хлороводородная", 9, 3, false, ""],
        ["SO<sub>3</sub><sup>2-</sup>", "Сульфиты", "Сернистая", 9, 4, false, ""],
        ["SO<sub>4</sub><sup>2-</sup>", "Сульфаты", "Серная", 9, 5, false, ""],
        ["S<sup>2-</sup>", "Сульфиды", "Сероводородная", 9, 6, false, ""],
        ["PO<sub>4</sub><sup>3-</sup>", "Фосфаты", "Фосфорная", 9, 7, false, ""],
        ["CO<sub>3</sub><sup>2-</sup>", "Карбонаты", "Угольная", 9, 8, false, ""],
        ["SiO<sub>3</sub><sup>2-</sup>", "Силикаты", "Кремниевая", 9, 9, false, ""]
    ];

    const triads = {
        "Fe, Co, Ni": [["Fe", "железо", "55.8", "+3"], ["Co", "кобальт", "58.9", "+2"], ["Ni", "никель", "58.6", "+2"]],
        "Ru, Rh, Pd": [["Ru", "рутений", "101.0", "+4"], ["Rh", "родий", "102.9", "+3"], ["Pd", "палладий", "106.4", "+2"]],
        "Os, Ir, Pt": [["Os", "осмий", "190.2", "+4"], ["Ir", "иридий", "192.2", "+4"], ["Pt", "платина", "195.0", "+4"]]
    };

    const container = document.getElementById('table-area');
    let currentEditPos = { col: 0, row: 0 };

    function render() {
        container.innerHTML = '';
        document.documentElement.style.setProperty('--cols', maxCols);
        container.appendChild(document.createElement('div')); 
        for (let c = 1; c <= maxCols; c++) {
            const h = document.createElement('div'); h.className = 'h-col'; h.innerText = roman(c); container.appendChild(h);
        }
        for (let r = 1; r <= maxRows; r++) {
            const rowNum = document.createElement('div'); rowNum.className = 'h-row'; rowNum.innerText = r; container.appendChild(rowNum);
            for (let c = 1; c <= maxCols; c++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.onclick = () => openEdit(c, r);
                const el = elements.find(e => e[3] === c && e[4] === r);
                if (el) {
                    cell.innerHTML = `
                        <div class="sym-row"><div class="sym">${el[0]}</div><div class="ox">${el[6]||''}</div></div>
                        <div class="nam">${el[1]}</div>
                        <div class="mas">${el[2]}</div>`;
                }
                container.appendChild(cell);
            }
        }
    }

    function addRow() { maxRows++; render(); }
    function addCol() { maxCols++; render(); }
    function roman(n) {
        const r = {M:1000,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1};
        let s = ''; for (let i in r) { while (n >= r[i]) { s += i; n -= r[i]; } } return s;
    }

    function openEdit(c, r) {
        currentEditPos = { col: c, row: r };
        const el = elements.find(e => e[3] === c && e[4] === r);
        document.getElementById('ed-sym').value = el ? el[0] : '';
        document.getElementById('ed-nam').value = el ? el[1] : '';
        document.getElementById('ed-mas').value = el ? el[2] : '';
        document.getElementById('ed-ox').value = el ? (el[6] || '') : '';
        document.getElementById('modal-ov').style.display = 'block';
    }

    function closeModal() { document.getElementById('modal-ov').style.display = 'none'; }

    function applyEdit() {
        const sym = document.getElementById('ed-sym').value;
        elements = elements.filter(e => !(e[3] === currentEditPos.col && e[4] === currentEditPos.row));
        if (sym) {
            elements.push([sym, document.getElementById('ed-nam').value, document.getElementById('ed-mas').value, currentEditPos.col, currentEditPos.row, false, document.getElementById('ed-ox').value]);
        }
        render(); closeModal();
    }

    function saveConfig() {
        const blob = new Blob([JSON.stringify({maxCols, maxRows, elements})], {type: 'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'config_with_acids.json'; a.click();
    }

    document.getElementById('loadCfg').onchange = e => {
        const reader = new FileReader();
        reader.onload = ev => {
            const d = JSON.parse(ev.target.result);
            maxCols = d.maxCols; maxRows = d.maxRows; elements = d.elements; render();
        };
        reader.readAsText(e.target.files[0]);
    };

    function saveJpg() {
        html2canvas(container, { scale: 2 }).then(c => {
            const a = document.createElement('a'); a.download = 'table_full.jpg'; a.href = c.toDataURL("image/jpeg", 0.9); a.click();
        });
    }

    render();
</script></body></html>
