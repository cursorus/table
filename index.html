<!DOCTYPE html><html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>Mendeleev Typography Style</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* 1. ШРИФТЫ */
        @font-face {
            font-family: 'LocalFont';
            src: url('font.ttf') format('truetype'),
                 url('font.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
        }

```
    :root {
        --f-main: 'LocalFont', 'Arial', sans-serif;
        --s-sym: 36px; --s-nam: 12px; --s-mas: 11px; --s-ox: 14px;
        --cols: 9;
        --accent: #007bff;
    }
    body { font-family: var(--f-main); background: #ffffff; padding: 20px; color: #1a1a1a; margin: 0; }
    
    .panel {
        background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px);
        padding: 20px; border-radius: 15px; display: flex; flex-wrap: wrap; gap: 20px;
        margin-bottom: 30px; border: 1px solid #eee; box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        position: sticky; top: 10px; z-index: 100; align-items: flex-end;
    }
    .c-item { display: flex; flex-direction: column; gap: 6px; font-size: 10px; font-weight: bold; color: #888; text-transform: uppercase; letter-spacing: 1px; }
    button.dl { 
        background: #1a1a1a; color: #fff; border: none; padding: 10px 18px; 
        cursor: pointer; border-radius: 8px; font-weight: bold; font-size: 12px;
        transition: all 0.2s;
    }
    button.dl:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .add-btn { background: var(--accent) !important; }
    .save-cfg { background: #2a9d8f !important; margin-left: auto; }
    
    #table-area {
        display: grid;
        grid-template-columns: 50px repeat(var(--cols), 125px);
        background: white; padding: 10px; width: fit-content;
    }
    .h-col, .h-row { font-weight: bold; color: #ddd; display: flex; align-items: center; justify-content: center; }
    .h-col { height: 40px; font-size: 18px; border-bottom: 1px solid rgba(0,0,0,0.05); }
    .h-row { width: 50px; font-size: 14px; border-right: 1px solid rgba(0,0,0,0.05); }
    
    /* ГРАНИЦЫ И ФОН ЯЧЕЕК */
    .cell { 
        display: flex; flex-direction: column; padding: 10px; 
        border: 1px solid transparent; 
        cursor: pointer; min-height: 110px; box-sizing: border-box; 
        background: #fff; /* Фон всегда белый */
        border-radius: 8px; 
        transition: transform 0.1s;
    }
    .cell:hover { transform: scale(1.02); z-index: 10; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
    
    .nam, .mas { text-transform: lowercase; }
    .sym-row { display: flex; justify-content: space-between; align-items: flex-start; width: 100%; margin-bottom: 2px; }
    
    /* БАЗОВЫЙ СТИЛЬ СИМВОЛА */
    .sym { font-size: var(--s-sym); font-weight: 1500; line-height: 1; color: #000; transition: color 0.3s; }
    .sym sub { font-size: 0.55em; vertical-align: sub; }
    .sym sup { font-size: 0.55em; vertical-align: super; }
    
    /* УМЕНЬШЕННЫЕ ЗВЕЗДОЧКИ для лантана и актиния */
    .sym .small-asterisk { font-size: 0.4em; vertical-align: super; }
    
    /* ========================================= */
    /* НОВАЯ ЛОГИКА ЦВЕТОВ (ТОЛЬКО БУКВЫ)      */
    /* ========================================= */
    
    /* Переходные элементы: Синие буквы */
    .cell.type-transition .sym { color: #006aff; }
    
    /* Металлы: Зеленые буквы */
    .cell.type-metal .sym { color: #2ea043; }
    
    /* Неметаллы: Красные буквы */
    .cell.type-nonmetal .sym { color: #da3633; }

    /* ========================================= */

    .ox { font-size: var(--s-ox); color: #e63946; font-weight: bold; background: #fff1f2; padding: 2px 5px; border-radius: 5px; }
    
    .nam { font-size: var(--s-nam); color: #333; font-weight: 700; margin-top: 2px; }
    .mas { font-size: var(--s-mas); color: #999; margin-top: 1px; line-height: 1.1; }
    .stack { display: flex; flex-direction: column; gap: 8px; }
    .stack-el { display: flex; flex-direction: column; border-bottom: 1px dashed #eee; padding-bottom: 4px; }
    .stack-el:last-child { border: none; }
    
    #modal-ov { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.3); backdrop-filter: blur(4px); z-index: 1000; }
    #modal { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 20px; width: 300px; box-shadow: 0 20px 50px rgba(0,0,0,0.2); }
    #modal input { width: 100%; margin-bottom: 15px; padding: 12px; border: 1px solid #eee; border-radius: 10px; box-sizing: border-box; background: #f9f9f9; }
    .modal-btns { display: flex; gap: 10px; }
    .modal-btns button { flex: 1; padding: 12px; cursor: pointer; border-radius: 10px; border: none; font-weight: bold; }
</style>
```

</head>
<body>

<div class="panel">
    <div class="c-item">Шрифт <input type="file" id="fontUp"></div>
    <div class="c-item">Размер <input type="range" min="15" max="60" value="36" oninput="upd('sym', this.value)"></div>
    <button class="dl add-btn" onclick="addRow()">+ Строка</button>
    <button class="dl add-btn" onclick="addCol()">+ Столбец</button>
    <div class="c-item">Конфиг <input type="file" id="loadCfg" accept=".json"></div>
    <button class="dl save-cfg" onclick="saveConfig()">Сохранить</button>
    <button class="dl" onclick="saveJpg()">JPG</button>
</div>

<div id="table-area"></div>

<div id="modal-ov">
    <div id="modal">
        <h4 style="margin:0 0 15px">Правка</h4>
        <input type="text" id="ed-sym" placeholder="Символ">
        <input type="text" id="ed-nam" placeholder="Название">
        <input type="text" id="ed-mas" placeholder="Масса / Кислота">
        <input type="text" id="ed-ox" placeholder="Заряд">
        <div class="modal-btns">
            <button onclick="applyEdit()" style="background:var(--accent); color:white">ОК</button>
            <button onclick="closeModal()" style="background:#f0f0f0">Отмена</button>
        </div>
    </div>
</div>

<script>
    const upd = (t, v) => document.documentElement.style.setProperty(`--s-${t}`, v + 'px');
    let maxCols = 9, maxRows = 10;
    
    // ДАННЫЕ В ПОЛНОЙ СОХРАННОСТИ
    let elements = [
        ["H", "водород", "1", 1, 1, false, "+1/-1"], ["He", "гелий", "4", 8, 1, false, "0"],
        ["Li", "литий", "7", 1, 2, false, "+1"], ["Be", "бериллий", "9", 2, 2, false, "+2"], ["B", "бор", "11", 3, 2, false, "+3"], ["C", "углерод", "12", 4, 2, false, "-4"], ["N", "азот", "14", 5, 2, false, "-3"], ["O", "кислород", "16", 6, 2, false, "-2"], ["F", "фтор", "19", 7, 2, false, "-1"], ["Ne", "неон", "20", 8, 2, false, "0"],
        ["Na", "натрий", "23", 1, 3, false, "+1"], ["Mg", "магний", "24", 2, 3, false, "+2"], ["Al", "алюминий", "27", 3, 3, false, "+3"], ["Si", "кремний", "28", 4, 3, false, "-4"], ["P", "фосфор", "31", 5, 3, false, "-3"], ["S", "сера", "32", 6, 3, false, "-2"], ["Cl", "хлор", "35.5", 7, 3, false, "-1"], ["Ar", "аргон", "40", 8, 3, false, "0"],
        ["K", "калий", "39", 1, 4, false, "+1"], ["Ca", "кальций", "40", 2, 4, false, "+2"], ["Sc", "скандий", "45", 3, 4, false, "+3"], ["Ti", "титан", "48", 4, 4, false, "+4"], ["V", "ванадий", "51", 5, 4, false, "+5"], ["Cr", "хром", "52", 6, 4, false, "+3"], ["Mn", "марганец", "55", 7, 4, false, "+2"],
        ["Fe, Co, Ni", "", "", 8, 4, true],
        ["Cu", "медь", "64", 1, 5, false, "+2"], ["Zn", "цинк", "65", 2, 5, false, "+2"], ["Ga", "галлий", "70", 3, 5, false, "+3"], ["Ge", "германий", "73", 4, 5, false, "-4"], ["As", "мышьяк", "75", 5, 5, false, "-3"], ["Se", "селен", "79", 6, 5, false, "-2"], ["Br", "бром", "80", 7, 5, false, "-1"], ["Kr", "криптон", "84", 8, 5, false, "0"],
        ["Rb", "рубидий", "85", 1, 6, false, "+1"], ["Sr", "стронций", "88", 2, 6, false, "+2"], ["Y", "иттрий", "89", 3, 6, false, "+3"], ["Zr", "цирконий", "91", 4, 6, false, "+4"], ["Nb", "ниобий", "93", 5, 6, false, "+5"], ["Mo", "молибден", "96", 6, 6, false, "+6"], ["Tc", "технеций", "98", 7, 6, false, "+7"],
        ["Ru, Rh, Pd", "", "", 8, 6, true],
        ["Ag", "серебро", "108", 1, 7, false, "+1"], ["Cd", "кадмий", "112", 2, 7, false, "+2"], ["In", "индий", "115", 3, 7, false, "+3"], ["Sn", "олово", "119", 4, 7, false, "+4"], ["Sb", "сурьма", "122", 5, 7, false, "-3"], ["Te", "теллур", "128", 6, 7, false, "-2"], ["I", "йод", "127", 7, 7, false, "-1"], ["Xe", "ксенон", "131", 8, 7, false, "0"],
        ["Cs", "цезий", "133", 1, 8, false, "+1"], ["Ba", "барий", "137", 2, 8, false, "+2"], ["La*", "лантан", "139", 3, 8, false, "+3"], ["Hf", "гафний", "178", 4, 8, false, "+4"], ["Ta", "тантал", "181", 5, 8, false, "+5"], ["W", "вольфрам", "184", 6, 8, false, "+6"], ["Re", "рений", "186", 7, 8, false, "+7"],
        ["Os, Ir, Pt", "", "", 8, 8, true],
        ["Au", "золото", "197", 1, 9, false, "+3"], ["Hg", "ртуть", "201", 2, 9, false, "+2"], ["Tl", "таллий", "204", 3, 9, false, "+3"], ["Pb", "свинец", "207", 4, 9, false, "+2"], ["Bi", "висмут", "209", 5, 9, false, "+3"], ["Po", "полоний", "209", 6, 9, false, "+4"], ["At", "астат", "210", 7, 9, false, "-1"], ["Rn", "радон", "222", 8, 9, false, "0"],
        ["Fr", "франций", "223", 1, 10, false, "+1"], ["Ra", "радий", "226", 2, 10, false, "+2"], ["Ac**", "актиний", "227", 3, 10, false, "+3"], ["Rf", "резерфордий", "267", 4, 10, false, "+4"], ["Db", "дубний", "268", 5, 10, false, "+5"], ["Sg", "сиборгий", "269", 6, 10, false, "+6"], ["Bh", "борий", "270", 7, 10, false, "+7"],
        ["Hs, Mt, Ds", "", "", 8, 10, true],
        // Кислоты - индексы перенесены в рамки степеней окисления
        ["NO<sub>2</sub>", "нитриты", "азотистая", 9, 1, false, "-"],
        ["NO<sub>3</sub>", "нитраты", "азотная", 9, 2, false, "-"],
        ["Cl", "хлориды", "хлороводородная", 9, 3, false, "-"],
        ["SO<sub>3</sub>", "сульфиты", "сернистая", 9, 4, false, "2-"],
        ["SO<sub>4</sub>", "сульфаты", "серная", 9, 5, false, "2-"],
        ["S", "сульфиды", "сероводородная", 9, 6, false, "2-"],
        ["PO<sub>4</sub>", "фосфаты", "фосфорная", 9, 7, false, "3-"],
        ["CO<sub>3</sub>", "карбонаты", "угольная", 9, 8, false, "2-"],
        ["SiO<sub>3</sub>", "силикаты", "кремниевая", 9, 9, false, "2-"]
    ];

    const triads = {
        "Fe, Co, Ni": [["Fe", "железо", "56", "+3"], ["Co", "кобальт", "59", "+2"], ["Ni", "никель", "59", "+2"]],
        "Ru, Rh, Pd": [["Ru", "рутений", "101", "+4"], ["Rh", "родий", "103", "+3"], ["Pd", "палладий", "106", "+2"]],
        "Os, Ir, Pt": [["Os", "осмий", "190", "+4"], ["Ir", "иридий", "192", "+4"], ["Pt", "платина", "195", "+4"]],
        "Hs, Mt, Ds": [["Hs", "хассий", "277", "+4"], ["Mt", "мейтнерий", "278", "+3"], ["Ds", "дармштадтий", "281", "+2"]]
    };
    
    // Списки для раскраски
    const nonMetals = new Set(["H","He","B","C","N","O","F","Ne","Si","P","S","Cl","Ar","As","Se","Br","Kr","Te","I","Xe","At","Rn"]);
    const transitions = new Set([
        "Sc","Ti","V","Cr","Mn","Fe","Co","Ni","Cu","Zn",
        "Y","Zr","Nb","Mo","Tc","Ru","Rh","Pd","Ag","Cd",
        "La*","Hf","Ta","W","Re","Os","Ir","Pt","Au","Hg",
        "Ac**","Rf","Db","Sg","Bh","Hs","Mt","Ds",
        // Триады
        "Fe, Co, Ni", "Ru, Rh, Pd", "Os, Ir, Pt", "Hs, Mt, Ds"
    ]);

    const container = document.getElementById('table-area');
    let currentEditPos = { col: 0, row: 0 };

    function render() {
        container.innerHTML = '';
        document.documentElement.style.setProperty('--cols', maxCols);
        container.appendChild(document.createElement('div')); 
        for (let c = 1; c <= maxCols; c++) {
            const h = document.createElement('div'); h.className = 'h-col'; h.innerText = roman(c); container.appendChild(h);
        }
        for (let r = 1; r <= maxRows; r++) {
            const rowNum = document.createElement('div'); rowNum.className = 'h-row'; rowNum.innerText = r; container.appendChild(rowNum);
            for (let c = 1; c <= maxCols; c++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                
                const el = elements.find(e => e[3] === c && e[4] === r);
                if (el) {
                    // Определение класса типа (логика та же, но красит через CSS)
                    const sym = el[0];
                    if (nonMetals.has(sym)) {
                        cell.classList.add('type-nonmetal');
                    } else if (transitions.has(sym)) {
                        cell.classList.add('type-transition');
                    } else if (!sym.includes('<')) { 
                        cell.classList.add('type-metal');
                    }

                    cell.onclick = () => openEdit(c, r);
                    if (el[5]) {
                        const st = document.createElement('div'); st.className = 'stack';
                        triads[el[0]].forEach(t => {
                            st.innerHTML += `<div class="stack-el">
                                <div class="sym-row"><div class="sym">${t[0]}</div><div class="ox">${t[3]}</div></div>
                                <div class="nam">${t[1]}</div>
                                <div class="mas">${t[2]}</div>
                            </div>`;
                        });
                        cell.appendChild(st);
                    } else {
                        // Обработка звездочек для La* и Ac**
                        let displaySym = el[0];
                        if (el[0] === 'La*') {
                            displaySym = 'La<span class="small-asterisk">*</span>';
                        } else if (el[0] === 'Ac**') {
                            displaySym = 'Ac<span class="small-asterisk">**</span>';
                        }
                        
                        cell.innerHTML = `<div class="sym-row"><div class="sym">${displaySym}</div><div class="ox">${el[6]||''}</div></div><div class="nam">${el[1]}</div><div class="mas">${el[2]}</div>`;
                    }
                }
                container.appendChild(cell);
            }
        }
    }

    function addRow() { maxRows++; render(); }
    function addCol() { maxCols++; render(); }
    function roman(n) { const r = {M:1000,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1}; let s = ''; for (let i in r) { while (n >= r[i]) { s += i; n -= r[i]; } } return s; }
    function openEdit(c, r) { currentEditPos = { col: c, row: r }; const el = elements.find(e => e[3] === c && e[4] === r); document.getElementById('ed-sym').value = el ? el[0] : ''; document.getElementById('ed-nam').value = el ? el[1] : ''; document.getElementById('ed-mas').value = el ? el[2] : ''; document.getElementById('ed-ox').value = el ? (el[6] || '') : ''; document.getElementById('modal-ov').style.display = 'block'; }
    function closeModal() { document.getElementById('modal-ov').style.display = 'none'; }
    function applyEdit() { const sym = document.getElementById('ed-sym').value; elements = elements.filter(e => !(e[3] === currentEditPos.col && e[4] === currentEditPos.row)); if (sym) elements.push([sym, document.getElementById('ed-nam').value, document.getElementById('ed-mas').value, currentEditPos.col, currentEditPos.row, false, document.getElementById('ed-ox').value]); render(); closeModal(); }
    function saveConfig() { const b = new Blob([JSON.stringify({maxCols, maxRows, elements})], {type: 'application/json'}); const a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = 'config_rounded.json'; a.click(); }
    document.getElementById('loadCfg').onchange = e => { const r = new FileReader(); r.onload = ev => { const d = JSON.parse(ev.target.result); maxCols = d.maxCols; maxRows = d.maxRows; elements = d.elements; render(); }; r.readAsText(e.target.files[0]); };
    document.getElementById('fontUp').onchange = e => { const r = new FileReader(); r.onload = ev => { const font = new FontFace('CustomFont', ev.target.result); font.load().then(l => { document.fonts.add(l); document.documentElement.style.setProperty('--f-main', 'CustomFont'); render(); }); }; r.readAsArrayBuffer(e.target.files[0]); };
    function saveJpg() { html2canvas(container, { scale: 3 }).then(c => { const a = document.createElement('a'); a.download = 'table_rounded.jpg'; a.href = c.toDataURL("image/jpeg", 1.0); a.click(); }); }
    render();
</script></body></html>
