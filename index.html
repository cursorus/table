<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Minimalist Periodic Table</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --main-font: 'Arial', sans-serif;
            --size-symbol: 24px;
            --size-name: 14px;
            --size-mass: 12px;
            --text-color: #000;
        }

        body { font-family: var(--main-font); padding: 20px; background: #fff; color: var(--text-color); }
        
        .controls {
            background: #f4f4f4; padding: 20px; border-radius: 12px;
            display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 30px;
            border: 1px solid #ddd;
        }

        .control-group { display: flex; flex-direction: column; gap: 5px; }

        /* Сетка таблицы БЕЗ границ */
        #table-container {
            display: inline-grid;
            grid-template-columns: repeat(18, minmax(80px, 1fr)); /* Стандартная длинная форма */
            gap: 15px;
            padding: 20px;
            background: white;
        }

        .element-cell {
            display: flex;
            flex-direction: column;
            align-items: flex-start; /* Все влево */
            text-align: left;
            line-height: 1.2;
        }

        .sym { font-size: var(--size-symbol); font-weight: bold; }
        .nam { font-size: var(--size-name); text-transform: lowercase; }
        .mas { font-size: var(--size-mass); opacity: 0.8; }

        button.download-btn {
            background: #007bff; color: white; border: none;
            padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold;
        }
        button.download-btn:hover { background: #0056b3; }
    </style>
</head>
<body>

<div class="controls">
    <div class="control-group">
        <label>Свой шрифт:</label>
        <input type="file" id="fontPicker" accept=".ttf,.otf,.woff">
    </div>
    <div class="control-group">
        <label>Размер символа:</label>
        <input type="range" min="10" max="60" value="24" oninput="updateSize('symbol', this.value)">
    </div>
    <div class="control-group">
        <label>Размер названия:</label>
        <input type="range" min="8" max="30" value="14" oninput="updateSize('name', this.value)">
    </div>
    <div class="control-group">
        <label>Размер массы:</label>
        <input type="range" min="8" max="30" value="12" oninput="updateSize('mass', this.value)">
    </div>
    <div class="control-group" style="justify-content: flex-end;">
        <button class="download-btn" onclick="downloadTable()">⬇ Скачать JPG</button>
    </div>
</div>

<div id="table-container">
    </div>

<script>
    // Обновление размеров текста
    function updateSize(type, val) {
        document.documentElement.style.setProperty(`--size-${type}`, val + 'px');
    }

    // Загрузка данных об элементах
    async function loadElements() {
        try {
            const response = await fetch('https://raw.githubusercontent.com/Bowserinator/Periodic-Table-JSON/master/PeriodicTableJSON.json');
            const data = await response.json();
            const container = document.getElementById('table-container');

            data.elements.forEach(el => {
                const cell = document.createElement('div');
                cell.className = 'element-cell';
                // Располагаем по сетке (xpos и ypos из API)
                cell.style.gridColumn = el.xpos;
                cell.style.gridRow = el.ypos;

                cell.innerHTML = `
                    <div class="sym">${el.symbol}</div>
                    <div class="nam">${el.name.toLowerCase()}</div>
                    <div class="mas">${el.atomic_mass.toFixed(2)}</div>
                `;
                container.appendChild(cell);
            });
        } catch (e) {
            console.error("Ошибка загрузки данных:", e);
        }
    }

    // Обработка шрифта
    document.getElementById('fontPicker').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const fontName = 'CustomUserFont';
                const fontFace = new FontFace(fontName, event.target.result);
                fontFace.load().then(f => {
                    document.fonts.add(f);
                    document.documentElement.style.setProperty('--main-font', fontName);
                });
            };
            reader.readAsArrayBuffer(file);
        }
    });

    // Функция скачивания JPG
    function downloadTable() {
        const table = document.getElementById('table-container');
        html2canvas(table, {
            backgroundColor: "#ffffff",
            scale: 2 // Улучшает качество картинки
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'periodic-table-custom.jpg';
            link.href = canvas.toDataURL("image/jpeg", 0.9);
            link.click();
        });
    }

    loadElements();
</script>

</body>
</html>
